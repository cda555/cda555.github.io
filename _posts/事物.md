# 什么是事物？

为了完成对数据的操作，企业应用经常要求并发访问在多个构件之间共享的数据。这些应用在下列条件下应该维护数据的完整性（由应用的商务规则来定义）：

- 分布式访问一个单独的数据资源
- 从一个单独的应用构件访问分布式资源

在这种情况，可能要求在（分布式）资源上的一组操作被当作一个工作单元（unit）。在一个工作单元中，操作的所有部分一起成功或失败并恢复。在下面的情况下这个问题更复杂：

- 通过一组分布式的、访问多个资源的数据的构件实现一个工作单元
- 部分操作时被顺序执行的或在要求协调和/或同步的并行线程中。

在所有情况下，都要求应用维护一个工作单元的成功或失败。在失败的情况下，所有资源要把数据状态返回到之前的状态（比如，工作单元开始之前的状态）。

事物的概念和事务管理器（或者一个事物处理服务）在一个工作单元中的维护数据完整性，这就简化了这样的企业级分布式应用的构造。

一个事物有下列属性的一个工作单元：

- **原子性（atomicity）**：一个事物要被完全的无二义性的做完或撤销。在任何操作出现一个错误的情况下，构成事物的所有操作的效果必须被撤销，数据应被回滚到以前的状态。
- **一致性（consistency）**:一个事务应该保护所有定义在数据上的不变的属性（例如完整性约束）。在完成了一个成功的事物时，数据应处于一致的状态。换句话说，一个事物应该把系统从一个一致状态装换到另一个一致状态。举个例子，在关系数据库的情况下，一个 一致的事物将保护定义在数据上的所有完整性约束。
  - 一致性是从业务层面定义约束，例如银行转账场景，转入和转出金额要平衡，又或者外键指向必须存在，这个C一方面依赖数据库的保证，例如原子性，也依赖业务特性和业务代码实现。
- **隔离性（lsolation）**：在同一个环境中可能有多个事物并发执行，而这个事物都应表现为独立执行。串行的执行一系列事务的效果应该同于并发的执行他们。这要求两件事：
  - 在一个事物执行过程中，数据的中间的（可能不一致）状态不应该被暴露给所有的其他事物。
  - 两个并发的事物应该不能操作同一项数据。数据库管理系统通常使用锁来实现这个特征。
- **持久性（durability）**：一个被完成的事物的效果应该是持久的。

这些属性叫做ACID属性，担保一个事物是永远不会不完整，数据永远不会不一致，并发事务是独立的，一个事物的效果是持久的。

# 事物的隔离级别

当多个线程都开启事物操作数据库中的数据时，数据库系统要进行隔离操作，以保证各个线程获取数据的准确性，在介绍数据库提供的各种隔离级别之前，我们先看看如果不考虑事物个隔离性，会发生的几个问题：

- **脏读**：脏读是指在一个事务处理过程里读取了另一个未提交的事物中的数据。
- **不可重复读**：一个事物范围内多次查询却返回了不同的数值，这是由于在查询间隔，被另一个事物修改并提交了修改。

- **幻读**：幻读是指一个事物对一批数据做更改，更改完成后，相同的更改条件下还有未更改的数据（新插入的数据）。、



### MySQL数据库提供的四种隔离级别

- **读未提交（Read  uncommitted）**:任何情况都无法保证
- **读已提交（Read committed）**:可以避免脏读
- **可重复读（Repeateble read)**:可以比较脏读、不可重复读
- **串行化(Serializable)**：可以避免脏读、不可重复读、幻读



